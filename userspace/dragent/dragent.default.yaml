#
# WARNING: Sysdig Agent default configuration, don't edit. Please use "dragent.yaml" instead
#
jmx:
  default_beans:
    - query: "java.lang:type=Memory"
      attributes:
        - name: HeapMemoryUsage
          alias: jvm.heap
          unit: B
        - name: NonHeapMemoryUsage
          alias: jvm.nonHeap
          unit: B
    - query: "java.lang:type=GarbageCollector,*"
      attributes:
        - name: CollectionCount
          type: counter
          alias: jvm.gc.{name}.count
        - name: CollectionTime
          type: counter
          alias: jvm.gc.{name}.time
          unit: ms
    - query: "java.lang:type=ClassLoading"
      attributes:
        - name: LoadedClassCount
          alias: jvm.class.loaded
        - name: UnloadedClassCount
          alias: jvm.class.unloaded
    - query: "java.lang:type=Threading"
      attributes:
        - name: ThreadCount
          alias: jvm.thread.count
        - name: DaemonThreadCount
          alias: jvm.thread.daemon
  per_process_beans:
    cassandra:
      pattern: "org.apache.cassandra.service.CassandraDaemon"
      beans:
        - query: "org.apache.cassandra.metrics:type=ClientRequest,scope=Read,name=Latency"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.read.count
        - query: "org.apache.cassandra.metrics:type=ClientRequest,scope=Read,name=TotalLatency"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.read.total.latency
              unit: us
        - query: "org.apache.cassandra.metrics:type=ClientRequest,scope=Write,name=Latency"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.write.count
        - query: "org.apache.cassandra.metrics:type=ClientRequest,scope=Write,name=TotalLatency"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.write.total.latency
              unit: us
        - query: "org.apache.cassandra.db:type=StorageProxy"  # Bean available only on Cassandra <= 2.1
          attributes:
            - name: RecentWriteLatencyMicros
              alias: cassandra.write.latency
              unit: us
            - name: RecentReadLatencyMicros
              alias: cassandra.read.latency
              unit: us
        - query: "org.apache.cassandra.metrics:type=Compaction,name=TotalCompactionsCompleted"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.compactions.count
        - query: "org.apache.cassandra.metrics:type=Compaction,name=PendingTasks"
          attributes:
            - name: Value
              alias: cassandra.compactions.pending
        - query: "org.apache.cassandra.metrics:type=Compaction,name=BytesCompacted"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.compactions.bytes
              unit: B
        - query: "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=Hits"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.keycache.hits
        - query: "org.apache.cassandra.metrics:type=Cache,scope=KeyCache,name=Requests"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.keycache.requests
        - query: "org.apache.cassandra.metrics:type=Cache,scope=RowCache,name=Hits"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.rowcache.hits
        - query: "org.apache.cassandra.metrics:type=Cache,scope=RowCache,name=Requests"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.rowcache.requests
        - query: "org.apache.cassandra.metrics:type=ThreadPools,path=internal,scope=HintedHandoff,name=ActiveTasks"
          attributes:
            - name: Value
              alias: cassandra.hintedhandoff.active
        - query: "org.apache.cassandra.metrics:type=ThreadPools,path=internal,scope=HintedHandoff,name=PendingTasks"
          attributes:
            - name: Value
              alias: cassandra.hintedhandoff.pending
        - query: "org.apache.cassandra.metrics:type=ThreadPools,path=request,scope=ReadStage,name=PendingTasks"
          attributes:
            - name: Value
              alias: cassandra.read.pending
        - query: "org.apache.cassandra.metrics:type=ThreadPools,path=request,scope=MutationStage,name=PendingTasks"
          attributes:
            - name: Value
              alias: cassandra.write.pending
        - query: "org.apache.cassandra.metrics:type=DroppedMessage,scope=MUTATION,name=Dropped"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.mutation.dropped
        - query: "org.apache.cassandra.metrics:type=DroppedMessage,scope=COUNTER_MUTATION,name=Dropped"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.counter.mutation.dropped
        - query: "org.apache.cassandra.metrics:type=DroppedMessage,scope=READ,name=Dropped"
          attributes:
            - name: Count
              type: counter
              alias: cassandra.read.dropped
    tomcat:
      pattern: "catalina"
      beans:
        - query: "Catalina:type=Cache,*"
          attributes:
            - name: accessCount
              alias: tomcat.access.count
              type: counter
            - name: hitsCount
              alias: tomcat.hits.count
              type: counter
        - query: "Catalina:type=GlobalRequestProcessor,*"
          attributes:
            - name: bytesReceived
              alias: tomcat.bytes.received
              type: counter
            - name: errorCount
              alias: tomcat.error.count
              type: counter
            - name: maxTime
              alias: tomcat.max.time
            - name: requestCount
              alias: tomcat.request.count
              type: counter
            - name: processingTime
              alias: tomcat.processing.time
              type: counter
              unit: ms
            - name: bytesSent
              alias: tomcat.bytes.sent
              type: counter
        - query: "Catalina:type=Manager,*"
          attributes:
            - name: activeSessions
              alias: tomcat.sessions.active
              type: counter
            - name: maxActive
              alias: tomcat.session.max.active
            - name: expiredSessions
              alias: tomcat.sessions.expired
              type: counter
            - name: sessionCreateRate
              alias: tomcat.session.create.rate
            - name: sessionExpireRate
              alias: tomcat.session.expire.rate
        - query: "Catalina:type=ThreadPool,*"
          attributes:
            - name: maxThreads
              alias: tomcat.threads.max
            - name: currentThreadCount
              alias: tomcat.thread.current.count
            - name: currentThreadsBusy
              alias: tomcat.threads.current.busy
        - query: "Catalina:type=JspMonitor,*"
          attributes:
            - name: jspCount
              alias: tomcat.jsp.count
              type: counter
            - name: jspReloadCount
              alias: tomcat.jsp.reload.count
              type: counter
        - query: "Catalina:j2eeType=Servlet,*"
          attributes:
            - name: processingTime
              alias: tomcat.servlet.processing.time
              type: counter
            - name: errorCount
              alias: tomcat.servlet.error.count
              type: counter
            - name: requestCount
              alias: tomcat.servlet.request.count
              type: counter
        - query: "Catalina:type=DataSource,*"
          attributes:
            - name: numActive
              alias: tomcat.datasource.connection.active
              type: counter
            - name: numIdle
              alias: tomcat.datasource.connection.idle
              type: counter
            - name: maxActive
              alias: tomcat.datasource.connection.max.active
            - name: maxIdle
              alias: tomcat.datasource.connection.max.idle
            - name: minIdle
              alias: tomcat.datasource.connection.min.idle
    activemq:
      pattern: "activemq"
      beans:
        - query: "org.apache.activemq:type=Broker,brokerName=*"
          attributes:
            - name: StorePercentUsage
              alias: activemq.broker.store.percentage.usage
              unit: "%100"
            - name: TempPercentUsage
              alias: activemq.broker.temp.percentage.usage
              unit: "%100"
            - name: MemoryPercentUsage
              alias: activemq.broker.memory.percentage.usage 
              unit: "%100"
            - name: TotalConnectionsCount
              alias: activemq.broker.total.connections.count
            - name: TotalConsumerCount
              alias: activemq.broker.total.consumer.count
            - name: TotalDequeueCount
              alias: activemq.broker.total.dequeue.count
            - name: TotalEnqueueCount
              alias: activemq.broker.total.enqueue.count
            - name: TotalMessageCount
              alias: activemq.broker.total.message.count
            - name: TotalProducerCount
              alias: activemq.broker.total.producer.count
        - query: "org.apache.activemq:type=Broker,brokerName=*,destinationType=Queue,*"
          attributes:
            - name: AverageEnqueueTime
              alias: activemq.queue.average.enqueue.time
            - name: ConsumerCount
              alias: activemq.queue.consumer.count
            - name: DequeueCount
              alias: activemq.queue.dequeue.count
              type: counter
            - name: DispatchCount
              alias: activemq.queue.dispatch.count
              type: counter
            - name: EnqueueCount 
              alias: activemq.queue.enqueue.count
              type: counter
            - name: ExpiredCount
              alias: activemq.queue.expired.count
              type: counter
            - name: InFlightCount
              alias: activemq.queue.inflight.count
              type: counter
            - name: MemoryPercentUsage
              alias: activemq.queue.memory.percentage.usage
              unit: "%100"
            - name: ProducerCount
              alias: activemq.queue.producer.count
            - name: QueueSize
              alias: activemq.queue.size
            - name: MaxEnqueueTime
              alias: activemq.queue.max.enqueue.time
            - name: MinEnqueueTime
              alias: activemq.queue.min.enqueue.time
        - query: "org.apache.activemq:type=Broker,brokerName=*,destinationType=Topic,*"
          attributes:
            - name: AverageEnqueueTime
              alias: activemq.topic.average.enqueue.time
            - name: ConsumerCount
              alias: activemq.topic.consumer.count
            - name: DequeueCount
              alias: activemq.topic.dequeue.count
              type: counter
            - name: DispatchCount
              alias: activemq.topic.dispatch.count
              type: counter
            - name: EnqueueCount
              alias: activemq.topic.enqueue.count
              type: counter
            - name: ExpiredCount
              alias: activemq.topic.expired.count
              type: counter
            - name: InFlightCount
              alias: activemq.topic.inflight.count
              type: counter
            - name: MemoryPercentUsage
              alias: activemq.topic.memory.percentage.usage
              unit: "%100"
            - name: ProducerCount
              alias: activemq.topic.producer.count
            - name: QueueSize
              alias: activemq.topic.size
            - name: MaxEnqueueTime
              alias: activemq.topic.max.enqueue.time
            - name: MinEnqueueTime
              alias: activemq.topic.min.enqueue.time
    zookeeper:
      pattern: "zookeeper"
      beans:
        - query: "org.apache.ZooKeeperService:name0=StandaloneServer*,*"
          attributes:
            - name: AvgRequestLatency
              alias: zookeeper.avg.request.latency
            - name: MaxRequestLatency
              alias: zookeeper.max.request.latency
            - name: MinRequestLatency
              alias: zookeeper.min.request.latency
            - name: NodeCount
              alias: zookeeper.node.count
            - name: NumAliveConnections
              alias: zookeeper.current.alive.connections
        - query: "org.apache.ZooKeeperService:name0=ReplicatedServer*,*"
          attributes:
            - name: QuorumSize
              alias: zookeeper.quorum.size
            - name: AvgRequestLatency
              alias: zookeeper.avg.request.latency
            - name: MaxRequestLatency
              alias: zookeeper.max.request.latency
            - name: MinRequestLatency
              alias: zookeeper.min.request.latency
            - name: NodeCount
              alias: zookeeper.node.count
            - name: NumAliveConnections
              alias: zookeeper.current.alive.connections
    kafka:
      pattern: "kafka"
      beans:
        - query: "kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.net.bytes_out
              type: counter
        - query: "kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.net.bytes_in
              type: counter
        - query: "kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec"
          attributes:
            - name: Count
              alias: kafka.messages_in
        - query: "kafka.server:type=BrokerTopicMetrics,name=BytesRejectedPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.net.bytes_rejected
              type: counter
        - query: "kafka.server:type=BrokerTopicMetrics,name=FailedFetchRequestsPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.request.fetch.failed
        - query: "kafka.server:type=BrokerTopicMetrics,name=FailedProduceRequestsPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.request.produce.failed
        - query: "kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Produce"
          attributes:
            - name: Mean
              alias: kafka.request.produce.time.avg
            - name: 99thPercentile
              alias: kafka.request.produce.time.99percentile
        - query: "kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Fetch"
          attributes:
            - name: Mean
              alias: kafka.request.fetch.time.avg
            - name: 99thPercentile
              alias: kafka.request.fetch.time.99percentile
        - query: "kafka.network:type=RequestMetrics,name=TotalTimeMs,request=UpdateMetadata"
          attributes:
            - name: Mean
              alias: kafka.request.update_metadata.time.avg
            - name: 99thPercentile
              alias: kafka.request.update_metadata.time.99percentile
        - query: "kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Metadata"
          attributes:
            - name: Mean
              alias: kafka.request.metadata.time.avg
            - name: 99thPercentile
              alias: kafka.request.metadata.time.99percentile
        - query: "kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Offsets"
          attributes:
            - name: Mean
              alias: kafka.request.offsets.time.avg
            - name: 99thPercentile
              alias: kafka.request.offsets.time.99percentile
        - query: "kafka.server:type=KafkaRequestHandlerPool,name=RequestHandlerAvgIdlePercent"
          attributes:
            - name: MeanRate
              alias: kafka.request.handler.avg.idle.pct
        - query: "kafka.server:type=ReplicaManager,name=IsrShrinksPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.replication.isr_shrinks
        - query: "kafka.server:type=ReplicaManager,name=IsrExpandsPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.replication.isr_expands
        - query: "kafka.controller:type=ControllerStats,name=LeaderElectionRateAndTimeMs"
          attributes:
            - name: MeanRate
              alias: kafka.replication.leader_elections
        - query: "kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec"
          attributes:
            - name: MeanRate
              alias: kafka.replication.unclean_leader_elections
    hbase:
      pattern: "hbase"
      beans:
        ### hbase 0.98 conf ###
        - query: "Hadoop:service=HBase,name=Master,sub=Server"
          attributes:
            - name: averageLoad
              alias: hbase.master.server.avg.load
            - name: numRegionServers
              alias: hbase.master.server.num.region.server
            - name: numDeadRegionServers
              alias: hbase.master.server.num.dead.region.server
        - query: "Hadoop:service=HBase,name=IPC,sub=IPC"
          attributes:
            - name: sentBytes
              alias: hbase.ipc.sent.bytes
              type: counter
            - name: receivedBytes
              alias: hbase.ipc.received.bytes
              type: counter
            - name: queueSize
              alias: hbase.ipc.queue.size
            - name: numOpenConnections
              alias: hbase.ipc.num.open.connections
        - query: "Hadoop:service=HBase,name=RegionServer,sub=Server"
          attributes:
            - name: blockCacheCount
              alias: hbase.region.server.block.cache.count
              type: counter
            - name: blockCacheEvictionCount
              alias: hbase.region.server.block.cache.eviction.count
              type: counter
            - name: blockCacheFreeSize
              alias: hbase.region.server.block.cache.free.size
            - name: blockCacheHitCount
              alias: hbase.region.server.block.cache.hit.count
              type: counter
            - name: blockCountHitPercent
              alias: hbase.region.server.block.count.hit.percent
            - name: blockCacheMissCount
              alias: hbase.region.server.block.cache.miss.count
              type: counter
            - name: blockCacheSize
              alias: hbase.region.server.block.cache.size
            - name: compactionQueueLength
              alias: hbase.region.server.compaction.queue.length
            - name: flushQueueLength
              alias: hbase.region.server.flush.queue.length
            - name: memStoreSize
              alias: hbase.region.server.mem.store.size
            - name: storeCount
              alias: hbase.region.server.store.count
              type: counter
            - name: readRequestCount
              alias: hbase.region.server.read.request.count
              type: counter
            - name: storeFileIndexSize
              alias: hbase.region.server.store.file.index.size
            - name: writeRequestCount
              alias: hbase.region.server.write.requests.count
              type: counter
            - name: totalRequestCount
              alias: hbase.region.server.total.request.count
              type: counter
            - name: slowAppendCount
              alias: hbase.region.server.slow.append.count
              type: counter
            - name: slowPutCount
              alias: hbase.region.server.slow.put.count
              type: counter
            - name: slowGetCount
              alias: hbase.region.server.slow.get.count
              type: counter
        ### hbase 0.95 conf ###
        - query: "hadoop:service=RegionServer,name=RegionServerStatistics"
          attributes:
            - name: blockCacheExpressCachingRatio
              alias: hbase.region.server.cache.caching.ration
            - name: blockCacheHitCachingRatio
              alias: hbase.region.server.cache.hit.ratio
            - name: callQueueLength
              alias: hbase.region.server.call.queue.length
            - name: compactionQueueLength
              alias: hbase.region.server.compaction.queue.length
            - name: compactionQueueSize
              alias: hbase.region.server.compaction.queue.size
            - name: flushQueueSize
              alias: hbase.region.server.flush.queue.size
            - name: hdfsBlocksLocalityIndex
              alias: hbase.region.server.blocks.locality.index
            - name: memstoreSizeMB
              alias: hbase.region.server.mem.store.size
            - name: numberOfOnlineRegions
              alias: hbase.region.server.online.regions
            - name: readRequestsCount
              alias: hbase.region.server.requests.count
            - name: slowHLogAppendCount
              alias: hbase.region.server.log.append.count
              type: counter
            - name: usedHeapMB
              alias: hbase.region.server.used.heap
            - name: writeRequestsCount
              alias: hbase.region.server.write.requests.count
              type: counter
            - name: blockCacheCount
              alias: hbase.region.server.block.cache.count
              type: counter
            - name: blockCacheEvictedCount
              alias: hbase.region.server.block.cache.eviction.count
              type: counter
            - name: blockCacheFreeMB
              alias: hbase.region.server.block.free.cache
            - name: blockCacheHitCount
              alias: hbase.region.server.block.cache.hit.count
              type: counter
            - name: blockCacheMissCount
              alias: hbase.region.server.block.cache.miss.count
              type: counter
            - name: blockCacheSizeMB
              alias: hbase.region.server.block.cache.size
            - name: fsPreadLatencyNumOps
              alias: hbase.region.server.fs.pread.latency.num
            - name: fsReadLatencyNumOps
              alias: hbase.region.server.fs.read.latency.num
            - name: fsWriteLatencyNumOps
              alias: hbase.region.server.fs.write.latency.num
            - name: NumberOfStores
              alias: hbase.region.server.store.number
            - name: NumberOfStorefiles
              alias: hbase.region.server.files.store.number
            - name: requestsPerSecond
              alias: hbase.region.server.request.per.second
            - name: storeFileIndexSizeMB
              alias: hbase.region.server.store.index.file.size
    elasticsearch:
      pattern: "elasticsearch"

prometheus:
  enabled: false
  interval: 10
  log_errors: true
  max_metrics: 1000
  max_metrics_per_process: 100
  max_tags_per_metric: 20

  # Filtering processes to scan. Processes not matching a rule will not
  # be scanned
  # If an include rule doesn't contain a port or port_filter in the conf
  # section, we will scan all the ports that a matching process is listening to.
  process_filter:
    - exclude:
        process.name: docker-proxy
    - exclude:
        container.image: sysdig/agent
    # special rule to exclude processes matching configured prometheus appcheck
    - exclude:
        appcheck.match: prometheus
    - include:
        container.label.io.prometheus.scrape: "true"
        conf:
            # Custom path definition
            # If the label doesn't exist we'll still use "/metrics"
            path: "{container.label.io.prometheus.path}"

            # Port definition
            # - If the label exists, only scan the given port.
            # - If it doesn't, use port_filter instead.
            # - If there is no port_filter defined, skip this process
            port: "{container.label.io.prometheus.port}"
            port_filter:
                - exclude: [9092,9200,9300]
                - include: 9090-9500
                - include: [9913,9984,24231,42004]
    - exclude:
        container.label.io.prometheus.scrape: "false"
    - include:
        kubernetes.pod.annotation.prometheus.io/scrape: true
        conf:
            path: "{kubernetes.pod.annotation.prometheus.io/path}"
            port: "{kubernetes.pod.annotation.prometheus.io/port}"
    - exclude:
        kubernetes.pod.annotation.prometheus.io/scrape: false

app_checks:
  - name: ceph
    interval: 30
    pattern:
      comm: ceph-mon
  - name: redis
    check_module: redisdb
    pattern: 
      comm: redis-server
    conf:
      host: 127.0.0.1
      port: "{port}"
  - name: mongodb
    check_module: mongo
    pattern: 
      comm: mongod
    conf:
      server: "mongodb://localhost:{port}/admin"
  - name: rabbitmq
    pattern:
      port: 15672
    conf:
      rabbitmq_api_url: "http://localhost:15672/api/"
      rabbitmq_user: guest
      rabbitmq_pass: guest
  - name: memcached
    check_module: mcache
    pattern:
      comm: memcached
    conf:
      url: localhost
      port: "{port}"
  - name: gearmand
    pattern:
      comm: gearmand
    conf:
      server: localhost
      port: "{port}"
  - name: lighttpd
    pattern:
      comm: lighttpd
    conf:
      lighttpd_status_url: "http://localhost:{port}/server-status?auto"
    log_errors: false
  - name: haproxy
    pattern:
      comm: haproxy
      port: 1936
    conf:
      username: stats
      password: stats
      url: http://localhost:1936/
      collect_aggregates_only: True
    log_errors: false
  - name: elasticsearch
    check_module: elastic
    pattern:
      port: 9200
      comm: java
    conf:
      url: http://localhost:9200
  - name: jenkins
    pattern:
      comm: java
      port: 50000
    conf:
      name: default
      jenkins_home: /var/lib/jenkins
  - name: nginx 
    check_module: nginx
    pattern:
      exe: "nginx: worker process" # nginx overwrites argv[0] that is parsed as exe on sysdig
    conf:
      nginx_status_url: "http://localhost:{port}/nginx_status/"
    log_errors: false
  - name: apache
    check_module: apache
    pattern: 
      comm: apache2
    conf:
      apache_status_url: "http://localhost:{port}/server-status?auto"
    log_errors: false
  - name: consul
    pattern:
      comm: consul
    conf:
      url: "http://localhost:8500"
      catalog_checks: yes
  - name: etcd
    pattern:
      comm: etcd
    conf:
      url: "http://localhost:2379"
    log_errors: false
  - name: couchdb
    check_module: couch
    pattern:
      comm: beam.smp
      arg: couch
      port: 5984
    conf:
      server: http://localhost:5984
  - name: couchbase
    pattern:
      comm: beam.smp
      arg: couchbase
      port: 8091
    conf:
      server: http://localhost:8091
  - name: fluentd
    pattern:
      comm: fluentd
    conf:
      monitor_agent_url: http://localhost:24220/api/plugins.json
  - name: hdfs
    pattern:
      comm: java
      arg: org.apache.hadoop.hdfs.server.namenode.NameNode
    conf:
      namenode: localhost
  - name: kyototycoon
    pattern:
      comm: ktserver
    conf:
      report_url: "http://localhost:{port}/rpc/report"
  # In the urls for mesos-master and mesos-slave/agent,
  # {mesos_url} will be replaced with either the hostname of the
  # autodetected mesos master/slave/agent if autodetection is enabled,
  # or an explicit value from mesos_state_uri otherwise.
  #
  # In the urls for marathon, {marathon_url} will be replaced with the
  # hostname of the first configured/discovered marathon framework.
  #
  # For all mesos and marathon apps, {auth_token} will either
  # be blank or an autogenerated token obtained via the
  # /acs/api/v1/auth/login endpoint.
  - name: mesos-master
    check_module: mesos_master
    interval: 30
    pattern: 
      comm: mesos-master
    conf:
      url: "{mesos_url}:{port}"
      auth_token: "{auth_token}"
      mesos_creds: "{mesos_creds}"
  - name: mesos-slave
    check_module: mesos_slave
    pattern: 
      comm: mesos-slave
    interval: 30
    conf:
      url: "{mesos_url}:{port}"
      auth_token: "{auth_token}"
      mesos_creds: "{mesos_creds}"
      # Name of individual tasks to monitor, if needed
      # tasks:
        # - mongo
        # - cassandra
  - name: mesos-agent
    check_module: mesos_slave
    pattern:
      comm: mesos-agent
    interval: 30
    conf:
      url: "{mesos_url}:{port}"
      auth_token: "{auth_token}"
      mesos_creds: "{mesos_creds}"
      # Name of individual tasks to monitor, if needed
      # tasks:
        # - mongo
        # - cassandra
  - name: marathon
    check_module: marathon
    interval: 30
    pattern: 
      arg: mesosphere.marathon.Main
    conf:
      url: "{marathon_url}"
      auth_token: "{auth_token}"
      marathon_creds: "{marathon_creds}"
  - name: marathon-dcos
    check_module: marathon
    interval: 30
    pattern:
      arg: marathon.jar
    conf:
      url: "{marathon_url}"
      auth_token: "{auth_token}"
      marathon_creds: "{marathon_creds}"
  - name: postgres
    pattern:
      comm: postgres
      port: 5432
    conf:
      unix_sock: "/var/run/postgresql/.s.PGSQL.{port}"
      username: postgres
  - name: postfix
    interval: 15
    pattern:
      comm: postfix
    conf:
      directory: /var/spool/postfix
      queues:
        - incoming
        - active
        - deferred
  - name: riak
    pattern:
      comm: beam.smp
      port: 8098
    conf:
      url: http://127.0.0.1:8098/stats
  - name: php-fpm
    check_module: php_fpm
    retry: false
    pattern:
      exe: "php-fpm: master process"
  - name: varnish
    interval: 15
    pattern:
      comm: varnishd
    conf:
      varnishstat: /usr/bin/varnishstat
  - name: voltdb
    pattern:
      comm: java
      arg: org.voltdb.VoltDB
    conf:
      port: 21212
#
# Warning: This is an example of kubernetes configuration. Please do not uncomment and edit here,
# use "dragent.yaml" instead.
#
# For User Guide, see http://support.sysdigcloud.com/hc/en-us/articles/206606883
#
# Example (overrides default setting):
#
# k8s_uri: https://vagrant:vagrant@10.0.2.231:4430
# k8s_autodetect: false
# k8s_ssl_cert_type: "PEM"
# k8s_ssl_cert: k8s-cfg.crt
# k8s_ssl_key: k8s-cfg.key
# k8s_ca_certificate: k8s-ca.crt
# k8s_ssl_verify_certificate: true
# k8s_timeout_s: 120
# k8s_bt_auth_token: k8s-token.tok
# k8s_delegated_nodes: 2
#

# End of kubernetes section

#
# Warning: This is an example of mesos configuration. Please do not uncomment and edit here,
# use "dragent.yaml" instead.
#
# For User Guide, see http://support.sysdigcloud.com/hc/en-us/articles/207886103
#
# Example (overrides default setting):
#
# mesos_state_uri: http://localhost:5050
# marathon_uris:
#   - http://localhost:8080
# mesos_autodetect: true
# mesos_timeout_ms: 30000
# mesos_follow_leader: false
# marathon_follow_leader: false
# mesos_user: mesos_admin
# mesos_password: mesos_secret
# marathon_user: marathon_admin
# marathon_password: marathon_secret
#

# End of mesos section

#
# USER-CONFIGURABLE EVENTS
#
# Warning: This is the default user-configurable-events configuration. Please do not uncomment or
# edit here, use "dragent.yaml" instead to override these settings.
#
# For User Guide, see http://support.sysdigcloud.com/hc/en-us/articles/210530163
#
#
# By default, events are enabled as defined by the configuration below, but only events with priority
# "information" and higher are emitted by the default setting of the logging system.
# 
# The following events setting examples demonstrate modifying of the default behavior:
#
# An entry in a section in dragent.yaml overrides the entire section in the default configuration in this file. 
#
# For example, the Pulling entry in the example below will permit only kubernetes pod Pulling events to be
# emitted and all other kubernetes pod events settings in this file will be ignored (however, other kubernetes
# sections - node and replicationController - remain intact and will be used as specified in the settings below):
#
# events:
#   kubernetes:
#     pod:
#       - Pulling
#
# Disable all kubernetes node and docker image events and limit docker container events to [attach, commit, copy]
# (components events in other sections will be collected as specified by default):
#
# events:
#   kubernetes:
#     node: none
#   docker:
#     image: none
#     container:
#       - attach
#       - commit
#       - copy
#
# To disable all events, set the kubernetes and docker items to none:
#   events:
#     kubernetes: none
#     docker: none
#
# Setting the log event priority to none will have the same effect as previous setting (no events transmitted):
#   log:
#     event_priority: none
#
# Enable all except the debug messages:
#   log:
#     event_priority: information
#
# In addition to bulleted lists, sequences can also be specified in a bracketed single line, eg.:
#
# events:
#   kubernetes:
#     pod: [Pulling, Pulled, Failed]
#
# So, the following two settings are equivalent, permitting only Pulling, Pulled, Failed events for pods to be emitted:
#
# events:
#   kubernetes:
#     pod: [Pulling, Pulled, Failed]
#
# events:
#   kubernetes:
#     pod:
#       - Pulling
#       - Pulled
#       - Failed
#
# A throttling mechanism implemented as a token bucket limits the
# number of custom user events that can be generated by any
# agent. This throttling is controlled by the following configuration
# options:
#  - rate: the number of tokens (i.e. right to send a custom user event)
#    gained per second. Defaults to 1.
#  - max_burst: the maximum number of tokens outstanding. Defaults to 1000.
#
# With these defaults, an agent could send up to 1000 custom user events after an initial quiet period,
# and then up to 1 event per second afterward, gaining the full 1000 burst back after 1000 seconds.
#
# Default settings for runtime follow below. Commented entries are disabled by default.
#

events:
  rate: 1
  max_burst: 1000
  kubernetes:
    node:
#      - TerminatedAllPods       # Terminated All Pods        (information)
      - RegisteredNode          # Node Registered            (information)
      - RemovingNode            # Removing Node              (information)
      - DeletingNode            # Deleting Node              (information)
#      - DeletingAllPods         # Deleting All Pods          (information)
      - TerminatingEvictedPod   # Terminating Evicted Pod    (information)
      - NodeReady               # Node Ready                 (information)
      - NodeNotReady            # Node not Ready             (information)
      - NodeSchedulable         # Node is Schedulable        (information)
      - NodeNotSchedulable      # Node is not Schedulable    (information)
      - CIDRNotAvailable        # CIDR not Available         (information)
      - CIDRAssignmentFailed    # CIDR Assignment Failed     (information)
      - Starting                # Starting Kubelet           (information)
      - KubeletSetupFailed      # Kubelet Setup Failed       (warning)
      - FailedMount             # Volume Mount Failed        (warning)
      - NodeSelectorMismatching # Node Selector Mismatch     (warning)
      - InsufficientFreeCPU     # Insufficient Free CPU      (warning)
      - InsufficientFreeMemory  # Insufficient Free Memory   (warning)
      - OutOfDisk               # Out of Disk                (information)
      - HostNetworkNotSupported # Host Network not Supported (warning)
      - NilShaper               # Undefined Shaper           (warning)
      - Rebooted                # Node Rebooted              (warning)
      - NodeHasSufficientDisk   # Node Has Sufficient Disk   (information)
      - NodeOutOfDisk           # Node Out of Disk Space     (information)
      - InvalidDiskCapacity     # Invalid Disk Capacity      (warning)
      - FreeDiskSpaceFailed     # Free Disk Space Failed     (warning)
    pod:
#      - Pulling             # Pulling Container Image                      (information)
#      - Pulled              # Container Image Pulled                       (information)
      - Failed              # Container Image Pull, Create or Start Failed (warning)
      - InspectFailed       # Container Image Inspect Failed               (warning)
      - ErrImageNeverPull   # Container Image NeverPull Policy Violation   (warning)
      - BackOff             # Back Off Container Start or Image Pull       (warning)
#      - Created             # Container Created                            (information)
#      - Started             # Container Started                            (information)
      - Killing             # Killing Container                            (information)
      - Unhealthy           # Container Unhealthy                          (warning)
#      - FailedSync          # Pod Sync Failed                              (warning)
#      - FailedValidation    # Failed Pod Configuration Validation          (warning)
      - FailedScheduling
      - OutOfDisk           # Out of Disk                                  (information)
      - HostPortConflict    # Host/Port Conflict                           (warning)
    replicationController:
      - SuccessfulCreate    # Pod Created       (information)
      - FailedCreate        # Pod Create Failed (warning)
      - SuccessfulDelete    # Pod Deleted       (information)
      - FailedDelete        # Pod Delete Failed (warning)
    replicaSet:
      - SuccessfulCreate    # Pod Created       (information)
      - FailedCreate        # Pod Create Failed (warning)
      - SuccessfulDelete    # Pod Deleted       (information)
      - FailedDelete        # Pod Delete Failed (warning)
    deployment:
      - SelectingAll                        # Selecting All Pods       (warning)
      - ScalingReplicaSet                   # Scaling Replica Set      (information)
      - DeploymentRollbackRevisionNotFound  # No revision to roll back (warning)
      - DeploymentRollbackTemplateUnchanged # Skipping Rollback        (warning)
      - DeploymentRollback                  # Rollback Done            (information)
    daemonSet:
      - SelectingAll                        # Selecting All Pods       (warning)
  docker:
    container:
#      - attach      # Container Attached      (information)
#      - commit      # Container Committed     (information)
#      - copy        # Container Copied        (information)
#      - create       # Container Created       (information)
#      - destroy      # Container Destroyed     (warning)
#      - die          # Container Died          (warning)
#      - exec_create # Container Exec Created  (information)
#      - exec_start  # Container Exec Started  (information)
#      - export      # Container Exported      (information)
      - kill         # Container Killed        (warning)
#      - oom          # Container Out of Memory (warning)
#      - pause       # Container Paused        (information)
#      - rename      # Container Renamed       (information)
#      - resize      # Container Resized       (information)
#      - restart      # Container Restarted     (warning)
#      - start        # Container Started       (information)
#      - stop         # Container Stopped       (information)
#      - top         # Container Top           (information)
#      - unpause     # Container Unpaused      (information)
#      - update      # Container Updated       (information)
    image:
#      - delete # Image Deleted  (information)
#      - import # Image Imported (information)
#      - pull   # Image Pulled   (information)
#      - push   # Image Pushed   (information)
#      - tag    # Image Tagged   (information)
#      - untag  # Image Untaged  (information)
    volume:
#      - create  # Volume Created    (information)
#      - mount   # Volume Mounted    (information)
#      - unmount # Volume Unmounted  (information)
#      - destroy # Volume Destroyed  (information)
    network:
#      - create     # Network Created       (information)
#      - connect    # Network Connected     (information)
#      - disconnect # Network Disconnected  (information)
#      - destroy    # Network Destroyed     (information)

# End of events section

# percentiles: [50, 95, 99]
group_percentiles:
  enabled: false

  # Filtering containers for which percentile data should be sent to the collector.
  # Data for only containers matching an include rule will be sent.
  process_filter:
    #- include:
    #    container.image: prom/prometheus
    #- include:
    #    container.name: sysdig-agent
    #- include:
    #    <env_tag>: prod
    - include:
        container.label.io.percentiles: "true"
    - exclude:
        container.label.io.percentiles: "false"
    - include:
        kubernetes.pod.annotation.percentiles.io: true
    - exclude:
        kubernetes.pod.annotation.percentiles.io: false

known_ports:
  - 902 # VMware 
  - 903 # VMware
  - 944 # NFS
  - 1025 # NFS
  - 1098 # RMI Activation - Java
  - 1099 # RMI Registry - Java
  - 1293 # IPSec
  - 1337 # neo4j-shell
  - 1494 # Citrix XenAPP thin client
  - 1512 # Microsoft WINS
  - 1521 # Oracle database
  - 1527 # Apache Derby
  - 1528 # Oracle database alternative
  - 1666 # Perforce
  - 2082 # CPanel
  - 2083 # CPanel SSL
  - 2086 # WebHost Manager
  - 2087 # WebHost Manager SSL
  - 2095 # CPanel Web mail
  - 2096 # CPanel Web mail SSL
  - 2181 # Apache Zookeeper
  - 2375 # Docker
  - 2376 # Docker SSL
  - 2380 # etc server-to-server
  - 2424 # OrientDB
  - 2483 # Oracle database
  - 2484 # Oracle SSL
  - 2809 # IBM WebSphere
  - 3020 # CIFS / SMB
  - 3306 # MySQL
  - 3478 # STUN
  - 4369 # Erlang epmd
  - 4730 # gearmand
  - 5222 # XMPP
  - 5223 # XMPP SSL
  - 5432 # Postgres
  - 5672 # AMQP
  - 5984 # CouchDB
  - 6379 # Redis
  - 6543 # Pylons Pyramid
  - 7000 # Cassandra Cluster
  - 7199 # JMX
  - 7474 # Neo4j
  - 8087 # Riak protocolbuffer
  - 8092 # Couchbase
  - 8099 # Riak handoff
  - 8139 # Puppet
  - 8140 # Puppet
  - 8243 # HTTPS for Apache Synapse
  - 8332 # Bitcoin
  - 8333 # Bitcoin
  - 8880 # IBM WebSphere SOAP
  - 8983 # Apache SOLR
  - 9160 # Cassandra Thrift
  - 9200 # Elastic search
  - 9332 # Litecoin
  - 9333 # Litecoin
  - 9997 # Splunk
  - 11211 # memcached
  - 11214 # memached SSL
  - 11215 # memcached SSL
  - 15433 # pgbouncer
  - 26379 # Redis sentinel
  - 27017 # MongoDB

# format of a mount filter is:
# ```
# mounts_filter:
#   - exclude: "device|filesystem|mount_directory"
#   - include: "pattern1|pattern2|pattern3"
# ```
mounts_filter:
  - exclude: "*|autofs|*"
  - exclude: "*|proc|*"
  - exclude: "*|cgroup|*"
  - exclude: "*|subfs|*"
  - exclude: "*|debugfs|*"
  - exclude: "*|devpts|*"
  - exclude: "*|fusectl|*"
  - exclude: "*|mqueue|*"
  - exclude: "*|rpc_pipefs|*"
  - exclude: "*|sysfs|*"
  - exclude: "*|devfs|*"
  - exclude: "*|devtmpfs|*"
  - exclude: "*|kernfs|*"
  - exclude: "*|ignore|*"
  - exclude: "*|rootfs|*"
  - exclude: "*|none|*"
  - exclude: "*|tmpfs|*"
  - exclude: "*|pstore|*"
  - exclude: "*|hugetlbfs|*"
  - exclude: "*|*|/etc/resolv.conf"
  - exclude: "*|*|/etc/hostname"
  - exclude: "*|*|/etc/hosts"
  - exclude: "*|*|/var/lib/rkt/pods/*"
  - exclude: "overlay|*|/opt/stage2/*"
  - exclude: "/dev/mapper/cl-root*|*|/opt/stage2/*"
  - exclude: "*|*|/dev/termination-log*"
  - exclude: "overlay|*|/var/lib/docker/overlay*/merged"
  - include: "*|*|*"
mounts_limit_size: 15

