#!/bin/sh
set -e

for SERVICE in $(dpkg -L draios-agent | sed '-nes@^/etc/init\.d/@@p')
do
	if [ -x "/etc/init.d/$SERVICE" ]; then
		if [ -x "`which invoke-rc.d 2>/dev/null`" ]; then
				invoke-rc.d $SERVICE stop || exit $?
		else
				/etc/init.d/$SERVICE stop || exit $?
		fi
	fi
done

DKMS_PACKAGE_NAME="@PACKAGE_NAME@"
DKMS_VERSION="@PROBE_VERSION@"

case "$1" in
	remove|upgrade|deconfigure)
		if [ -x "`which dkms 2>/dev/null`" ]; then
			if [ "$(dkms status -m $DKMS_PACKAGE_NAME -v $DKMS_VERSION)" ]; then
				dkms remove -m $DKMS_PACKAGE_NAME -v $DKMS_VERSION --all
			fi
		fi
	;;
esac

if [ -d "@CMAKE_INSTALL_PREFIX@/lib" ]; then
	# Clean all generated Python bytecode
	find @CMAKE_INSTALL_PREFIX@/lib -iname "*.pyc" -delete > /dev/null 2>&1
	find @CMAKE_INSTALL_PREFIX@/lib -iname "*.pyo" -delete > /dev/null 2>&1
fi
